{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
    {{ block.super }}
    <script src="{% url 'admin:jsi18n' %}"></script>
    {{ media }}
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const checkboxDescarte = document.getElementById("id_descartado");
            if (checkboxDescarte) {
                checkboxDescarte.addEventListener('click', function(e) {
                    if (this.checked) {
                        const confirmacao = confirm("ATENÇÃO: Tem certeza que deseja marcar esta encomenda como descartada?\n\nEla desaparecerá das listas principais e só poderá ser vista no filtro 'Lixeira'.");
                        if (!confirmacao) {
                            e.preventDefault();
                            this.checked = false;
                        }
                    }
                });
            }
        });
    </script>
{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static "admin/css/forms.css" %}">
    
    <style>
        /* Botão Voltar no Topo */
        .btn-voltar-topo {
            display: inline-flex; align-items: center; 
            background: #6c757d; color: white; padding: 10px 20px; 
            border-radius: 5px; text-decoration: none; font-weight: bold; 
            margin-bottom: 20px; font-size: 13px; text-transform: uppercase;
        }
        .btn-voltar-topo:hover { background: #5a6268; color: white; }

        /* Barra de Botões Inferior Personalizada */
        .custom-submit-row {
            padding: 12px 14px; margin: 0 0 20px; background: #f8f9fa;
            border: 1px solid #e9ecef; border-radius: 5px; text-align: right;
            overflow: hidden; display: flex; justify-content: space-between; align-items: center;
        }

        /* Grupo da Direita (Salvar + Cancelar) */
        .submit-right-group { display: flex; gap: 10px; align-items: center; }

        /* Botão Cancelar */
        .btn-cancelar {
            background: #dc3545; color: white; height: 35px; line-height: 35px;
            padding: 0 15px; border-radius: 4px; text-transform: uppercase;
            font-size: 11px; font-weight: bold; letter-spacing: 0.5px;
            text-decoration: none; border: none; cursor: pointer; display: inline-block;
        }
        .btn-cancelar:hover { background: #c82333; color: white; }

        /* Botão Apagar (Esquerda) */
        .btn-apagar {
            background: transparent; color: #bd2130; font-weight: bold;
            text-decoration: none; padding: 10px; font-size: 13px;
        }
        .btn-apagar:hover { text-decoration: underline; color: #a71d2a; }

        /* Ajuste para inputs do Django ficarem alinhados */
        .custom-submit-row input { margin: 0 !important; height: 35px; }
    </style>
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% block content %}
<div id="content-main">
    
    <div>
        <a href="{% url opts|admin_urlname:'changelist' %}" class="btn-voltar-topo">← Voltar</a>
    </div>

    {% block object-tools %}
    {% if change %}{% if not is_popup %}
      <ul class="object-tools">
        {% block object-tools-items %}
          {% change_form_object_tools %}
        {% endblock %}
      </ul>
    {% endif %}{% endif %}
    {% endblock %}
    
    <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}{% if form_url %}action="{{ form_url }}" {% endif %}method="post" id="{{ opts.model_name }}_form" novalidate>{% csrf_token %}{% block form_top %}{% endblock %}
        <div>
        {% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1">{% endif %}
        {% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}">{% endif %}
        {% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}
        
        {% if errors %}
            <p class="errornote">
            {% if errors|length == 1 %}{% translate "Please correct the error below." %}{% else %}{% translate "Please correct the errors below." %}{% endif %}
            </p>
            {{ adminform.form.non_field_errors }}
        {% endif %}

        {% block field_sets %}
        {% for fieldset in adminform %}
          {% include "admin/includes/fieldset.html" %}
        {% endfor %}
        {% endblock %}

        {% block after_field_sets %}{% endblock %}

        {% block inline_field_sets %}
        {% for inline_admin_formset in inline_admin_formsets %}
            {% include inline_admin_formset.opts.template %}
        {% endfor %}
        {% endblock %}

        {% block after_related_objects %}{% endblock %}

        {% block submit_buttons_bottom %}
        <div class="custom-submit-row">
            
            <div class="submit-left">
                {% if change and has_delete_permission %}
                    {% url opts|admin_urlname:'delete' original.pk|admin_urlquote as delete_url %}
                    <a href="{% add_preserved_filters delete_url %}" class="btn-apagar">Apagar {{ opts.verbose_name }}</a>
                {% endif %}
            </div>

            <div class="submit-right-group">
                <a href="{% url opts|admin_urlname:'changelist' %}" class="btn-cancelar">Cancelar</a>
                
                {% if show_save_and_add_another %}<input type="submit" value="{% translate 'Save and add another' %}" name="_addanother">{% endif %}
                {% if show_save_and_continue %}<input type="submit" value="{% translate 'Save and continue editing' %}" name="_continue">{% endif %}
                <input type="submit" value="{% translate 'Save' %}" class="default" name="_save">
            </div>
        </div>
        {% endblock %}

        {% block admin_change_form_document_ready %}
            <script id="django-admin-form-add-constants" src="{% static 'admin/js/change_form.js' %}"
                {% if adminform and add %}
                    data-model-name="{{ opts.model_name }}"
                {% endif %}
                async>
            </script>
        {% endblock %}

        {# JavaScript for prepopulated fields #}
        {% prepopulated_fields_js %}

        </div>
    </form>
</div>
{% endblock %}