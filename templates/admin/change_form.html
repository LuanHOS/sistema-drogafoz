{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
    {{ block.super }}
    <script src="{% url 'admin:jsi18n' %}"></script>
    {{ media }}
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const checkboxDescarte = document.getElementById("id_descartado");
            if (checkboxDescarte) {
                checkboxDescarte.addEventListener('click', function(e) {
                    if (this.checked) {
                        const confirmacao = confirm("ATENÇÃO: Tem certeza que deseja marcar esta encomenda como descartada?\n\nEla desaparecerá das listas principais e só poderá ser vista no filtro 'Lixeira'.");
                        if (!confirmacao) {
                            e.preventDefault();
                            this.checked = false;
                        }
                    }
                });
            }
        });
    </script>
{% endblock %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static "admin/css/forms.css" %}">
    
    <style>
        /* ========================
           BOTÃO VOLTAR (TOPO) 
           ======================== */
        .btn-voltar-container {
            margin-bottom: 25px; /* Espaço para separar do título */
            display: block;
            margin-left: 0; /* Garante alinhamento total à esquerda */
            padding-left: 0;
        }
        .btn-voltar-topo {
            display: inline-flex; 
            align-items: center; 
            background: #6c757d; /* Cinza */
            color: white !important; 
            padding: 8px 20px; 
            border-radius: 4px; 
            text-decoration: none; 
            font-weight: bold; 
            font-size: 13px; 
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: background 0.2s;
        }
        .btn-voltar-topo:hover { 
            background: #5a6268; 
            color: white;
        }

        /* ========================
           BARRA DE AÇÕES (INFERIOR)
           ======================== */
        .submit-row {
            padding: 15px 20px; 
            margin: 20px 0; 
            background: #f8f9fa; 
            border: 1px solid #e9ecef; 
            border-radius: 5px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }

        /* CLASSE COMUM PARA TODOS OS BOTÕES INFERIORES
           Garante que todos tenham exatamente a mesma geometria */
        .btn-admin-action {
            height: 40px;               /* Altura fixa igual para todos */
            padding: 0 25px;            /* Largura interna igual */
            border-radius: 4px;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 13px !important; /* Força o tamanho da fonte igual para links e inputs */
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: background 0.3s;
            box-sizing: border-box;
            min-width: 120px;           /* Largura mínima para uniformidade */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: normal;        /* Normaliza alinhamento vertical */
            vertical-align: middle;
        }

        /* Cores Específicas */

        /* 1. APAGAR (Vermelho) - Estilizando o link .deletelink do Django */
        a.deletelink {
            background-color: #C51625 !important; 
            color: white !important;
        }
        a.deletelink:hover {
            background-color: #a71d2a !important;
        }

        /* 2. CANCELAR (Cinza) */
        .btn-cancelar {
            background-color: #6c757d !important; 
            color: white !important;
            margin-right: 10px; /* Espaço entre Cancelar e Salvar */
        }
        .btn-cancelar:hover {
            background-color: #5a6268 !important;
        }

        /* 3. SALVAR (Verde) */
        .submit-row input[type=submit].default {
            background-color: #28a745 !important; 
            color: white !important;
        }
        .submit-row input[type=submit].default:hover {
            background-color: #218838 !important;
        }
        
        /* Botões secundários de salvar (Save and add another, etc) */
        .submit-row input[type=submit]:not(.default) {
            background: #17a2b8 !important;
            color: white !important;
            margin-right: 10px;
        }
    </style>
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% block content %}

<div class="btn-voltar-container">
    <a href="{% url opts|admin_urlname:'changelist' %}" class="btn-voltar-topo">← Voltar para a lista</a>
</div>

<div id="content-main">
    {% block object-tools %}
    {% if change %}{% if not is_popup %}
      <ul class="object-tools">
        {% block object-tools-items %}
          {% change_form_object_tools %}
        {% endblock %}
      </ul>
    {% endif %}{% endif %}
    {% endblock %}
    
    <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}{% if form_url %}action="{{ form_url }}" {% endif %}method="post" id="{{ opts.model_name }}_form" novalidate>{% csrf_token %}{% block form_top %}{% endblock %}
        <div>
        {% if is_popup %}<input type="hidden" name="{{ is_popup_var }}" value="1">{% endif %}
        {% if to_field %}<input type="hidden" name="{{ to_field_var }}" value="{{ to_field }}">{% endif %}
        {% if save_on_top %}{% block submit_buttons_top %}{% submit_row %}{% endblock %}{% endif %}
        
        {% if errors %}
            <p class="errornote">
            {% if errors|length == 1 %}{% translate "Please correct the error below." %}{% else %}{% translate "Please correct the errors below." %}{% endif %}
            </p>
            {{ adminform.form.non_field_errors }}
        {% endif %}

        {% block field_sets %}
        {% for fieldset in adminform %}
          {% include "admin/includes/fieldset.html" %}
        {% endfor %}
        {% endblock %}

        {% block after_field_sets %}{% endblock %}

        {% block inline_field_sets %}
        {% for inline_admin_formset in inline_admin_formsets %}
            {% include inline_admin_formset.opts.template %}
        {% endfor %}
        {% endblock %}

        {% block after_related_objects %}{% endblock %}

        {% block submit_buttons_bottom %}
        <div class="submit-row">
            
            <div class="submit-left">
                {% if change and has_delete_permission %}
                    {% url opts|admin_urlname:'delete' original.pk|admin_urlquote as delete_url %}
                    <a href="{% add_preserved_filters delete_url %}" class="btn-admin-action deletelink">Apagar {{ opts.verbose_name }}</a>
                {% endif %}
            </div>

            <div class="submit-row-right">
                <a href="{% url opts|admin_urlname:'changelist' %}" class="btn-admin-action btn-cancelar">Cancelar</a>
                
                {% if show_save_and_add_another %}
                    <input type="submit" value="{% translate 'Save and add another' %}" name="_addanother" class="btn-admin-action">
                {% endif %}
                
                {% if show_save_and_continue %}
                    <input type="submit" value="{% translate 'Save and continue editing' %}" name="_continue" class="btn-admin-action">
                {% endif %}
                
                <input type="submit" value="{% translate 'Save' %}" class="default btn-admin-action" name="_save">
            </div>
        </div>
        {% endblock %}

        {% block admin_change_form_document_ready %}
            <script id="django-admin-form-add-constants" src="{% static 'admin/js/change_form.js' %}"
                {% if adminform and add %}
                    data-model-name="{{ opts.model_name }}"
                {% endif %}
                async>
            </script>
        {% endblock %}

        {# JavaScript for prepopulated fields #}
        {% prepopulated_fields_js %}

        </div>
    </form>
</div>
{% endblock %}