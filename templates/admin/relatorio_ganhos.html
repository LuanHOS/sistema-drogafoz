{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
    {{ block.super }}
    <style>
        .dashboard-container { padding: 20px; max-width: 1200px; margin: 0 auto; }
        
        /* Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #ccc; }
        .stat-card h3 { margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; color: #666; }
        .stat-card .value { font-size: 28px; font-weight: bold; color: #333; }
        .stat-card .sub { font-size: 12px; color: #888; margin-top: 5px; }

        /* Cores Espec√≠ficas */
        .card-green { border-left-color: #28a745; }
        .card-green .value { color: #28a745; }
        
        .card-blue { border-left-color: #123C65; }
        .card-blue .value { color: #123C65; }

        .card-orange { border-left-color: #fd7e14; }
        .card-orange .value { color: #fd7e14; }

        .card-red { border-left-color: #C51625; }
        .card-red .value { color: #C51625; }

        /* Filtro */
        .filter-bar { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .filter-form { display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap; }
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group label { font-size: 12px; font-weight: bold; color: #555; }
        .btn-filtrar { background: #123C65; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .btn-filtrar:hover { background: #0d2b4a; }
        
        .section-title { margin-top: 40px; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 10px; color: #333; }
        
        .checkbox-container { display: flex; align-items: center; gap: 8px; padding-bottom: 10px; }
        .checkbox-container input { width: 18px; height: 18px; cursor: pointer; }
        .checkbox-container label { cursor: pointer; font-size: 14px; }
    </style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    
    <h1>Relat√≥rio de Gest√£o</h1>
    
    <div class="filter-bar">
        <form method="get" class="filter-form">
            <div class="form-group">
                <label>Data Inicial:</label>
                <input type="date" name="data_inicial" value="{{ data_inicial }}" class="form-control" {% if ignorar_periodo %}disabled{% endif %} id="dt_ini">
            </div>
            <div class="form-group">
                <label>Data Final:</label>
                <input type="date" name="data_final" value="{{ data_final }}" class="form-control" {% if ignorar_periodo %}disabled{% endif %} id="dt_fim">
            </div>
            
            <div class="form-group" style="margin-left: 10px;">
                <label>&nbsp;</label> <div class="checkbox-container">
                    <input type="checkbox" name="ignorar_periodo" id="chk_ignorar" {% if ignorar_periodo %}checked{% endif %} onchange="toggleDates()">
                    <label for="chk_ignorar">Mostrar Todo o Hist√≥rico</label>
                </div>
            </div>

            <div class="form-group">
                <label>&nbsp;</label>
                <button type="submit" class="btn-filtrar">Atualizar Relat√≥rio</button>
            </div>
        </form>
    </div>

    <h2 class="section-title">üìä Desempenho do Per√≠odo <small style="font-size: 0.6em; color: #666; font-weight: normal;">({{ periodo_label }})</small></h2>
    <div class="stats-grid">
        <div class="stat-card card-green">
            <h3>Faturamento (Entregues)</h3>
            <div class="value">R$ {{ faturamento_periodo|floatformat:2 }}</div>
            <div class="sub">{{ qtd_entregues_periodo }} encomendas baixadas</div>
        </div>

        <div class="stat-card card-blue">
            <h3>Ticket M√©dio</h3>
            <div class="value">R$ {{ ticket_medio|floatformat:2 }}</div>
            <div class="sub">M√©dia por cliente neste per√≠odo</div>
        </div>

        <div class="stat-card">
            <h3>Novas Encomendas</h3>
            <div class="value">{{ qtd_chegadas_periodo }}</div>
            <div class="sub">Caixas recebidas na loja</div>
        </div>
    </div>

    <h2 class="section-title">üì¶ Status Atual do Estoque <small style="font-size: 0.6em; color: #666; font-weight: normal;">(Independente da data selecionada)</small></h2>
    <div class="stats-grid">
        <div class="stat-card card-orange">
            <h3>Pendentes no Estoque</h3>
            <div class="value">{{ estoque_atual_qtd }}</div>
            <div class="sub">Caixas aguardando retirada hoje</div>
        </div>

        <div class="stat-card card-red">
            <h3>Potencial a Receber</h3>
            <div class="value">R$ {{ estoque_atual_valor|floatformat:2 }}</div>
            <div class="sub">Valor Base acumulado nas prateleiras</div>
        </div>
    </div>

</div>

<script>
    function toggleDates() {
        var chk = document.getElementById('chk_ignorar');
        var dtIni = document.getElementById('dt_ini');
        var dtFim = document.getElementById('dt_fim');
        
        if (chk.checked) {
            dtIni.disabled = true;
            dtFim.disabled = true;
        } else {
            dtIni.disabled = false;
            dtFim.disabled = false;
        }
    }
    // Roda ao carregar para garantir estado correto
    document.addEventListener("DOMContentLoaded", function() {
        toggleDates();
    });
</script>
{% endblock %}